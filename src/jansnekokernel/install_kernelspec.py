#!/usr/bin/python
import os, shutil
from jupyter_client.kernelspec import KernelSpecManager
json ="""{"argv":["python","-m","jansnekokernel", "-f", "{connection_file}"],
 "display_name":"Neko"
}"""

svg = """<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   version="1.1"
   viewBox="0 0 299.99999 300"
   xml:space="preserve"
   id="svg2406"
   width="300"
   height="300"
   sodipodi:docname="neko.svg"
   inkscape:version="1.2.2 (732a01da63, 2022-12-09)"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg"><sodipodi:namedview
   id="namedview15"
   pagecolor="#505050"
   bordercolor="#ffffff"
   borderopacity="1"
   inkscape:showpageshadow="0"
   inkscape:pageopacity="0"
   inkscape:pagecheckerboard="1"
   inkscape:deskcolor="#505050"
   showgrid="false"
   inkscape:zoom="1.9539717"
   inkscape:cx="73.440161"
   inkscape:cy="188.84613"
   inkscape:window-width="1920"
   inkscape:window-height="1009"
   inkscape:window-x="-8"
   inkscape:window-y="-8"
   inkscape:window-maximized="1"
   inkscape:current-layer="g2404" /><defs
   id="defs2410" />
<style
   type="text/css"
   id="style2369">
	.bg{fill:#F38821;}
	.eyes{fill:#F38821;}
	.mouth{fill:#F38821;}
	.cheek{fill:#F38821;}
	.head{fill:#F38821;}
	.outline{fill:#F38821;}
	.copy{fill:#F38821;}
	.background{fill:#F38821;}
</style>
<g
   transform="matrix(1.6127712,0,0,1.6127712,-9909.3642,-1372.2069)"
   id="g2404"
   style="fill:#faf8ea">
	
	
<path
   style="fill:#ff4b00;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
   d="M 42.989363,282.50153 16.3769,201.1288 41.965807,93.655398 18.935791,15.353344 l 72.160716,45.036475 38.895133,-9.723784 20.98291,22.006459 16.88868,-22.518237 41.45402,7.676672 66.01938,-39.406916 -2.55889,25.588906 -16.3769,57.830931 27.12424,79.83739 -10.74734,71.64893 -16.88868,25.07713 -29.17135,-33.26558 -40.94225,-4.09422 -17.91223,45.54825 -33.77736,-1.53533 -21.49468,-45.54826 -48.618924,10.74734 z"
   id="path352"
   transform="matrix(0.62005075,0,0,0.62005075,6144.3089,850.83792)" /><path
   class="cheek"
   d="m 6124.5,890.3 c 0,0 2.8,-3.3 7,-4 -2.6,-0.1 -3.5,0.7 -4.2,0.1 -0.8,-0.5 1,-2.2 1,-2.2 0,0 -5.7,3.3 -3.8,6.1 z"
   id="path2371"
   style="fill:#faf8ea"
   transform="matrix(3.9145883,0,0,3.9145883,-17801.079,-2483.1808)" /><path
   class="eyes"
   d="m 6130.5,872.5 c 0,0 4.1,3.4 5.1,1.9 1,-1.6 -2.1,-2 -5.1,-1.9 z"
   id="path2373"
   style="fill:#faf8ea"
   transform="matrix(3.9145883,0,0,3.9145883,-17801.079,-2483.1808)" /><path
   class="eyes"
   d="m 6150.9,872.5 c 0,0 -4.1,3.4 -5.1,1.9 -0.9,-1.6 2.1,-2 5.1,-1.9 z"
   id="path2375"
   style="fill:#faf8ea"
   transform="matrix(3.9145883,0,0,3.9145883,-17801.079,-2483.1808)" /><path
   class="cheek"
   d="m 6157.3,890.3 c 0,0 -2.8,-3.3 -7,-4 2.6,-0.1 3.5,0.7 4.2,0.1 0.7,-0.6 -1,-2.2 -1,-2.2 0,0 5.7,3.3 3.8,6.1 z"
   id="path2377"
   style="fill:#faf8ea"
   transform="matrix(3.9145883,0,0,3.9145883,-17801.079,-2483.1808)" /><path
   class="head"
   d="m 6123,858.8 c -0.2,0.7 0.1,2.5 0.1,2.5 0,0 1.4,1.8 2,3.6 0.6,1.8 0.8,2.9 -1,6.9 -1.4,2.8 -1.5,5 -1.9,5.8 -0.7,1.4 -1.3,0.8 -1.1,4.4 0,0 5,-3.9 3.4,-4.8 -1.2,-0.7 0.9,-2.5 4.8,-3 -1.6,-1.5 -0.3,-3.7 2.4,-3.4 2.7,0.4 4.7,2.3 7.1,3.5 0.6,0.3 0.9,-0.9 0.4,-1.5 -0.7,-0.8 -1.9,-1 -1.9,-1.8 0,-0.6 1.8,-1 1.4,-2 -0.6,-1.6 -3,-0.4 -3.6,-1.4 -0.6,-1 -0.1,-1.7 1.1,-1.9 1.2,-0.2 -0.1,-3.9 -3.2,-2.6 -3.1,1.3 -4.2,0.3 -6.1,-1.6 -1.3,-1.4 -2.6,-2.2 -3.9,-2.7 z m 1.2,3 c 4,1.4 5.2,3.8 5.2,3.8 0,0 -1.2,1.2 -3,1.8 0.7,-4.3 -2.2,-5.6 -2.2,-5.6 z"
   id="path2379"
   style="fill:#faf8ea"
   transform="matrix(3.9145883,0,0,3.9145883,-17801.079,-2483.1808)" /><path
   class="head"
   d="m 6158.1,858.8 c 0.2,0.7 -0.1,2.5 -0.1,2.5 0,0 -1.4,1.8 -2,3.6 -0.6,1.8 -0.8,2.9 1,6.9 1.4,2.8 1.5,5 1.9,5.8 0.7,1.4 1.3,0.8 1.1,4.4 0,0 -5,-3.9 -3.4,-4.8 1.2,-0.7 -0.9,-2.5 -4.8,-3 1.6,-1.5 0.3,-3.7 -2.4,-3.4 -2.7,0.4 -4.7,2.3 -7.1,3.5 -0.6,0.3 -0.9,-0.9 -0.4,-1.5 0.7,-0.8 1.9,-1 1.9,-1.8 0,-0.6 -1.8,-1 -1.4,-2 0.6,-1.6 3,-0.4 3.6,-1.4 0.6,-1.1 0.1,-1.7 -1.1,-1.9 -1.2,-0.2 0.1,-3.9 3.2,-2.6 3.1,1.3 4.2,0.3 6.1,-1.6 1.3,-1.4 2.5,-2.2 3.9,-2.7 z m -1.2,3 c -4,1.4 -5.2,3.8 -5.2,3.8 0,0 1.2,1.2 3,1.8 -0.8,-4.3 2.2,-5.6 2.2,-5.6 z"
   id="path2381"
   style="fill:#faf8ea"
   transform="matrix(3.9145883,0,0,3.9145883,-17801.079,-2483.1808)" /><path
   class="outline"
   d="m 6119.2,852 c -0.7,7 3.4,13.3 3.7,14.2 0.3,0.8 0.2,2.2 -0.7,3.1 -2.7,3.4 -3.7,13.6 -3.7,17.5 0.1,3.9 1.1,4.4 1.1,4.4 0,0 0.1,-0.5 0.7,-1.4 0.1,1.9 0.7,5.5 4.3,8.9 1,-8 8.1,-8.3 10.1,-8 0.1,1 2,6.3 2.3,6.6 0.2,0.3 4.9,1.9 7.3,0.1 2.4,-1.9 0.8,-4 2.7,-6.6 7.7,-1 10.1,5.5 9.8,8.1 3,-3 3.6,-6.6 3.6,-6.6 0,0 0.8,0.5 1.3,1 3.8,-11.6 -2.2,-23.6 -3.6,-25.9 4.5,-9.3 3.9,-12.8 3.6,-14.9 -3.2,2.8 -10.2,7.5 -12.4,7.5 -2.2,0 -3.3,-1.3 -6.3,-1.8 0,1.2 -2.2,3.7 -2.2,3.7 0,0 -1.6,-1.9 -2.4,-3.7 -2.8,-0.1 -4.5,2.2 -6.7,1.7 -4.7,-1.3 -12.5,-7.9 -12.5,-7.9 z m 40.5,3.8 c 0,0 0.6,1.5 0.2,2.2 -0.4,0.7 -0.9,2.2 -1.2,3.2 -0.3,1 -0.8,3.3 -1.4,4.2 -0.6,0.9 -1.3,1.9 1,6 2.3,4.1 3.5,13 2.3,13 -1.3,0 -3.2,-3.3 -5.8,-4.4 -2.6,-1.1 -4.8,-1.1 -6.9,-1.1 -1.3,0 -2.9,0.5 -3,1.4 -0.1,0.6 0.9,0.4 2.3,0.8 1.5,0.4 1.2,1.1 0.9,1.7 -0.3,0.7 -1.7,0.1 -3,-0.2 -1.3,-0.3 -2.9,-0.9 -2.7,-1.4 0.4,-1.3 1.6,-1.5 1.6,-2.8 0,-0.8 -1.4,-1.8 -3.1,-1.8 -1.7,0 -2.3,0.5 -2.8,1.3 -0.5,0.8 0.8,2.1 1.1,2.8 0.6,1.1 -2.4,2.9 -4.5,2.4 -2,-0.5 0.1,-2.4 1.7,-2.5 2,-0.2 0,-1.7 -2.8,-1.7 -2.8,0 -3.9,0.5 -5.4,1.1 -1.5,0.6 -3.6,1 -7.6,4.5 -0.6,-7.6 2.9,-13.5 3.5,-14.3 0.6,-0.8 1.2,-1.9 0.7,-3 -2.5,-5.8 -3.3,-11.2 -3.3,-11.2 0,0 3,2.3 6.4,4.6 3.4,2.3 5.7,1.4 9.3,0.2 1,5.4 3.7,7.6 3.7,7.6 2.2,-1.9 3,-5.4 2.7,-6.4 -0.2,-1 -0.1,-2.1 2.2,-1.2 3.7,1.2 4.4,1.1 7.7,-0.4 3.1,-1.6 6.2,-4.6 6.2,-4.6 z m -28.8,26 c 2,2.5 2,2.5 4.3,2.7 0.9,2.5 0.4,3.3 3.3,8.4 0,-0.2 0.1,-8.1 0.1,-8.1 0,0 0.9,0.2 0.8,1 0.1,0.9 0,1.8 0,1.8 l 0.8,-0.9 0.7,0.9 0.8,-0.8 0.7,0.8 c 0,0 0.1,-1.3 0.1,-1.9 0,-0.4 0.9,-1 0.9,-1 v 4 l -0.5,4.4 c 0,0 2.2,-3.1 2.9,-8.1 2.9,-1 4.3,-2.1 4.3,-3.2 2.1,-0.4 8.9,1.7 9.3,6.4 -0.1,2.4 -1.1,5.1 -1.1,5.1 0,0 -3.1,-5.1 -11.9,-4.6 -1.7,2.8 -2.1,4.9 -2.3,6.4 -0.3,1.4 -1.7,1.7 -2.8,1.7 -1,0 -2.5,-0.5 -3.2,-1.4 -0.7,-0.9 -1.7,-5.6 -2.7,-6.7 -1.8,-0.8 -9.2,0.5 -12.1,4.9 -1.6,-5.3 -0.7,-11.3 7.6,-11.8 z"
   id="path2383"
   style="fill:#faf8ea;display:inline"
   transform="matrix(3.9145883,0,0,3.9145883,-17801.079,-2483.1808)" /><path
   class="mouth"
   d="m 6139.2,893 h 3.1 v -1.9 l -0.9,0.9 -0.7,-0.8 -0.7,0.7 -0.8,-0.8 z"
   id="path2385"
   style="fill:#faf8ea;display:inline"
   transform="matrix(3.9145883,0,0,3.9145883,-17801.079,-2483.1808)" /></g>
</svg>
"""

def install_kernelspec():
    kerneldir = "/tmp/jansnekokernel/"
    print('Creating tmp files...', end="")
    os.mkdir(kerneldir)

    with open(kerneldir + "kernel.json", "w") as f:
        f.write(json)

    with open(kerneldir + "logo-svg.svg", "w") as f:
        f.write(svg)
        
    print(' Done!')
    print('Installing Jupyter kernel...', end="")
    
    ksm = KernelSpecManager()
    ksm.install_kernel_spec(kerneldir, 'jansnekokernel', user=os.getenv('USER'))
    
    print(' Done!')
    print('Cleaning up tmp files...', end="")
    
    shutil.rmtree(kerneldir)
    
    print(' Done!')
    print('For uninstall use: jupyter kernelspec uninstall jansnekokernel')